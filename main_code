import random
import time

class Graph:
    def __init__(self, vertices):
        self.vertices = vertices
        self.matrix = self.make_matrix()

    def make_matrix(self):
        matrix = []
        for i in range(self.vertices):
            row = []
            for k in range(self.vertices):
                row.append(0)
            matrix.append(row)

        return matrix

    def den_generate(self, density):
        self.density = density
        for i in range(self.vertices):
            for k in range(self.vertices): 
                rand_density = random.randint(1, 100)
                if i == k:
                    self.matrix[i][k] = 0 
                    continue
                if rand_density <= density: 
                    self.matrix[i][k] = 1
                else:
                    self.matrix[i][k] = 0

    def show_matrix(self):
        for row in self.matrix:
            print(row)

    def warshall(self):
        self.d_matrix = []
        for r in range(self.vertices):
            row = []
            for m in range(self.vertices):
                row.append(self.matrix[r][m])
            self.d_matrix.append(row)

        for k in range(self.vertices):
            for i in range(self.vertices):
                for l in range(self.vertices):
                    self.d_matrix[i][l] = self.d_matrix[i][l] or (self.d_matrix[i][k] and self.d_matrix[k][l])
        return self.d_matrix

    def show_d_matrix(self):
        for row in self.d_matrix:
            print(row)

    def dict_of_contiguity(self):
        con_dict = {}
        for i in range(self.vertices):
            con_dict[i] = []
            for k in range(self.vertices):
                if self.matrix[i][k] == 1:
                    con_dict[i].append(k)
        return con_dict


    def show_con(self):
        contiguity = self.dict_of_contiguity()
        for i in contiguity:
            print(f"{i}: {contiguity[i]}")


class TimeCounting:

    def __init__(self, iter_num):
        self.iter_num = iter_num

    def count(self, vertices, density):
        count_time = 0
        with open("count_time_of_creating_graph.txt", "a", encoding="utf-8") as file:
            file.write(f"\nТестування: {vertices} вершин, {density}% щільності\n")
        for i in range(self.iter_num):
            graph = Graph(vertices)
            graph.den_generate(density)
            start_time = time.time()
            graph.warshall()
            end_time = time.time()
            current_experiment_time = end_time - start_time
            with open("count_time_of_creating_graph.txt", "a", encoding="utf-8") as file:
                file.write(f"{i+1} експеримент: {current_experiment_time:.5f} сек\n")

            count_time += end_time - start_time
        average_time = count_time/self.iter_num
        with open("average_time_of_creating_graph.txt", "a", encoding="utf-8") as file:
            file.write(f"Середній час для 30 ітерацій графа на {vertices} вершин та {density}% щільності - {average_time:.6f}")
            file.write("\n")
        return f"Середній час для 30 ітерацій графа на {vertices} вершин та {density}% щільності - {average_time:.6f}"
list_vertices = [50, 60, 70, 80, 100, 120, 140, 150, 170, 190]
list_density = [30, 40, 50, 60, 70]
for i in list_vertices:
    for k in list_density:

        matrix1 = Graph(int(i))
        matrix1.den_generate(int(k))
        matrix1.warshall()

        print("матриця суміжності: ")
        matrix1.show_matrix()

        print("матриця досяжності: ")
        matrix1.show_d_matrix()

        print("списки суміжності:")
        matrix1.dict_of_contiguity()
        matrix1.show_con()

        experiment1 = TimeCounting(30)
        print(experiment1.count(int(i), int(k)))
